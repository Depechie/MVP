<?xml version="1.0" encoding="UTF-8"?>
<pages:BaseContentPage xmlns="http://xamarin.com/schemas/2014/forms"                       
                       xmlns:local="clr-namespace:MVP"
                       xmlns:pages="clr-namespace:MVP.Pages"
                       xmlns:converters="clr-namespace:Xamarin.CommunityToolkit.Converters;assembly=Xamarin.CommunityToolkit"
                       xmlns:xct="clr-namespace:Xamarin.CommunityToolkit.Extensions;assembly=Xamarin.CommunityToolkit"
                       xmlns:vm="clr-namespace:MVP.ViewModels"
                       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                       x:Class="MVP.Pages.ContributionsPage"
                       x:DataType="vm:ContributionsViewModel"
                       x:Name="page"
                       x:TypeArguments="vm:ContributionsViewModel"
                       xmlns:state="clr-namespace:Xamarin.CommunityToolkit.UI.Views;assembly=Xamarin.CommunityToolkit"  >

    <pages:BaseContentPage.Resources>
        <converters:MultiConverter x:Key="NotLoadingConverter">
            <converters:StateToBooleanConverter StateToCompare="Loading" />
            <converters:InvertedBoolConverter />
        </converters:MultiConverter>
    </pages:BaseContentPage.Resources>

    <local:AppFrame SecondaryButtonText="Add"
                    ShowSecondaryButton="{Binding State, Converter={StaticResource NotLoadingConverter}}"
                    Title="{xct:Translate contributions_title}"
                    x:Name="appFrame">
        <local:AppFrame.Content>
            <Grid state:StateLayout.CurrentState="{Binding State}"
                  state:StateLayout.AnimateStateChanges="False">

                <state:StateLayout.StateViews>
                    <state:StateView StateKey="Loading"
                                     RepeatCount="3"
                                     RepeatTemplate="{StaticResource contribution_item_loading}" />
                </state:StateLayout.StateViews>

                <CollectionView ItemsSource="{Binding Contributions}"
                                ItemsUpdatingScrollMode="KeepScrollOffset"
                                ItemTemplate="{StaticResource contribution_item}"
                                Scrolled="CollectionView_Scrolled"
                                SelectionMode="None"
                                RemainingItemsThreshold="{Binding ItemThreshold}"
                                RemainingItemsThresholdReachedCommand="{Binding LoadMoreCommand}"
                                x:Name="collectionView">

                    <CollectionView.Footer>
                        <!--Want to re-use the template so creating a faux list of items -->
                        <StackLayout IsVisible="{Binding IsLoadingMore}"
                                     BindableLayout.ItemTemplate="{StaticResource contribution_item_loading}"
                                     BindableLayout.ItemsSource="{StaticResource faux_list}" />
                    </CollectionView.Footer>

                </CollectionView>

            </Grid>
        </local:AppFrame.Content>
    </local:AppFrame>
</pages:BaseContentPage>
